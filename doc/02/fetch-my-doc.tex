\documentclass{fetch-my-doc}
\usepackage{tabu}
%\usepackage{multirow}
\usepackage{siunitx}
%\usepackage{enumitem}
%\usepackage{fancyvrb}
%\usepackage{breakurl}
%\usepackage{tocloft}
%\usepackage{pdflscape}
%\usepackage{ltxtable}
%\usepackage{filecontents}
\usepackage{onimage}

\usepackage{verbatim}

\sisetup{output-decimal-marker = {,}}

\definecolor{darkgreen}{rgb}{0,.5,0}

\hypersetup{breaklinks,colorlinks=true,citecolor=darkgreen,urlcolor=blue,linkcolor=blue,anchorcolor=blue} %,pdftex=true}

\newcommand{\hypref}[1]{\SaveVerb{myverb}|#1|\hyperlink{#1}{\protect\UseVerb{myverb}}}

\newcommand{\sep}{\begin{center}\noindent\rule{.5\textwidth}{0.5pt}\end{center}}

\newcommand{\rc}{\rowcolor{lightgray!40}}
\newcommand{\cc}{\columncolor{lightgray!40}}

\makeatletter
\newcommand*{\shift}[2]{%
  \settowidth{\@tempdima}{#2}%
  \makebox[\@tempdima]{\hspace*{#1}#2}%
}
\makeatother

% Linebreak nach paragraph
\makeatletter
\renewcommand\paragraph{%
   \@startsection{paragraph}{4}{0mm}%
      {-\baselineskip}%
      {.5\baselineskip}%
      {\normalfont\normalsize\bfseries}}
\makeatother

\def\imagetop#1{\raisebox{2.5em}{\vtop{\null\hbox{#1}}}}

%\renewcommand{\datum}{14.10.2012}
\renewcommand{\datum}{\today}
\renewcommand{\abgabe}{14.07.2014}
\renewcommand{\version}{1.0.0}
	%	Versionierung:
	%	x.y.z
	%	- x hoch bei ?
	%	- y hoch bei größeren Änderungen von ganzen Absätzen.
	%	- z hoch bei kleinen Verbesserungen wie Rechtschreibung, Satzbau, usw.
\renewcommand{\typ}{Dokumentation}
\renewcommand{\titel}{Dokumentation}
\renewcommand{\libdir}{./}
\bibliography{referenzen}

\setcounter{tocdepth}{4}
\setcounter{secnumdepth}{3}

\tikzset{
    image label/.style={
        every node/.style={
            fill=white,
            fill opacity=.5,
            text opacity=1,
            text=orange,
            font=\fontfamily{phv}\selectfont\Large\bfseries}
        }
}

\tikzset{
  state/.style={
         rectangle,
         rounded corners,
         draw=black, very thick,
         minimum height=2em,
         inner sep=2pt,
         text centered,
         },
}

\begin{document}
	\sloppy
	\input{fetch-my-doc-title.tex}
	\addtolength{\textheight}{\versch}
	%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
	% TODOS ENTFERNEN NICHT VERGESSEN! %
	%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
	\printtodo
	%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
	\addtocontents{toc}{\protect\sloppy}
	\tableofcontents
	\clearpage
	
	%\section{Versions- und Änderungsgeschichte}\label{sec:versionsaenderung}
		%\begin{tabularx}{\textwidth}{ccX}
			%\toprule
			%Version			&	Datum						&	Änderungen	\\\midrule
			%1.0.0				&	14.07.2014			&	Erste veröffentlichte Version	\\
			%\bottomrule
		%\end{tabularx}	
		%\clearpage
	
	%\rowcolors*{0}{}{lightgray!40}
	
	%%%%%%%%%% Hier beginnt das Dokument %%%%%%%%%%
	\section{Einführung}\label{sec:Einfuehrung}
		\autor{Hannes, Andreas}
		
		Im Rahmen der Veranstaltung \textit{Lisp Tutorial} haben wir ein Projekt durchgeführt, um die in den Vorlesungen gewonnenen Kenntnisse in die Praxis umzusetzen.
		
		In dieser Dokumentation wird auf die Aufgabenstellung, die Zielsetzung und die Rahmenbedingungen des Projekts eingegangen. Weiterhin wird die Umsetzung sowohl in der Hardware, als auch in der Software erläutert und auf bei der Durchführung aufgetretene Probleme eingegangen.
    
    \subsection{Rahmenbedingungen}\label{sec:rahmenbedingungen}
      \autor{Andreas}
      In unserem Projekt soll der \textit{Lego Mindstorms NXT} zusammen mit anderen Legokomponenten verbaut und mittels \textit{ROSLisp} programmiert werden.
      Der von uns zu verwendende Bausatz besteht aus folgenden relevanten Bauteilen:
      \begin{itemize}
        \item Drei Schrittmotiren,
        \item ein Ultraschallsensor,
        \item ein Farbsensor (RGB),
        \item ein Ton-/Schallsensor und
        \item zwei Stoßsensoren.
      \end{itemize}
    
    \subsection{Aufgabenstellung}
     \autor{Andreas}
      Unter den in Abschnitt \ref{sec:rahmenbedingungen} erläuterten Bedingungen soll ein Roboter konstruiert werden, der eine einfache Aufgabe lösen kann. Dabei soll er autonom vorgehen.
      
    
  \section{Problemstellung}
    \autor{Hannes, Andreas}
    Unter den gegebenen Bedingungen haben wir folgende zu lösende Problemstellung gewählt (Auszug aus der bereits abgegebenen Projektübersicht).
    
    \glqq\textit{Unsere gewählte Problemstellung beinhaltet das Finden, Aufheben und Zurückbringen eines farbigen Balls in einem bekannten rechteckigen Bereich. Der Bereich ist durch einen einfarbigen Rand und gegebenenfalls eine Bande begrenzt. Größe des Bereichs und Dimensionen sowie Farbe des Randes und der Bande sind im Verlauf des Projekts festzulegen. Der Ball soll an den Startpunkt des Roboters transportiert werden.}\grqq
    
    Im Verlauf des Projekts hat sich diese Problemstellung insofern geändert, als dass der Ball nicht zurückgebracht werden soll, sondern außerhalb des markierten Bereichs transportiert und dort abgelegt werden soll. Die Ausmaße des Bereichs betragen ca. $\SI{80}{\centi\meter} \cdot \SI{80}{\centi\meter}$, die Farbe des Bereichs trägt die RGB-Werte \verb+0.0 0.0 0.0+, die Breite des Randes beträgt ca. \SI{20}{\centi\meter}, die Farbe des Randes ist \verb+1.0 1.0 1.0+ und die Farbe des Balls ist irrelevant.
    
    Weiterhin muss um den Rand nach außen hin in jede Richtung mindestens ca. \SI{113}{\centi\meter} Abstand zu etwaigen Gegenständen bestehen, damit der von uns verwendete Ultraschallsensor keine irrelevanten Dinge wahrnimmt und somit der Ablauf unseres Programms gestört wird.
  
    \subsection{Ziele}
    
    Die oben beschriebene Situation sollte mithilfe der Umsetzung folgender Teilziele gelöst werden. 
    
      \begin{itemize}
        \item Der Roboter soll den Ball finden.
        \item Der Ball soll angefahren werden.
        \item Mithilfe des Greifers soll der Ball gegriffen werden.
        \item Der Ball soll aus dem Bereich transportiert werden.
        \item Ein überschreiten der weißen Fläche soll erkannt und darauf reagiert werden.
      \end{itemize}
      
      
    Damit keine Wände oder umliegende Gegenstände als Ball erkannt werden können, muss ein Bereich vom maximalen Durchmesser des Feldes, um dieses herum, frei sein.

	\section{Technischer Aufbau}\label{sec:Aufbau}
		\autor{Tom Gehrke}
    Unser Roboter wurde wie in der Aufgabenstellung beschrieben mittels der Lego NXT-Plattform, dem ROS-Framework und Common Lisp betrieben. Auf dem Roboter selber lief hierbei nur der NXT. Das Steuerprogramm wurde einem Rechner ausgeführt, welcher mittels USB-Schnittstelle mit dem NXT-Baustein kommunizieren konnte. Für die Schnittstelle zu ROS wurde das Paket NXT-ROS verwendet.

  Am Roboter befinden sich zwei verschiedene Sensoren: Ein Ultraschall-Sensor (d) mit Ausrichtung nach vorne und ein RGB-Farbsensor (c) mit Ausrichtung nach unten. Des weiteren verfügt der Roboter über drei Motoren, von denen zwei für die Steuerung der beiden Hinterräder zuständig sind (a, b), und einer den Gripper kontrolliert (e).
    
    \begin{center}
      \begin{minipage}[t]{.49\textwidth}
        \begin{figure}[H]%
          \centering%
          \caption{Die erste Version des Balls}%
          \label{}%
          \includegraphics[width=\columnwidth]{img/ball1.jpg}%
        \end{figure}
      \end{minipage}
      \hfill
      \begin{minipage}[t]{.49\textwidth}
        \begin{figure}[H]%
          \centering%
          \caption{Die finale Version des Balls}%
          \label{}%
          \includegraphics[width=\columnwidth]{img/ball2.jpg}%
        \end{figure}
      \end{minipage}
    \end{center}
    
    \begin{figure}[H]%
      \centering%
      \caption{blbla}%
      \label{}%
      \begin{tikzonimage}[width=\textwidth]{img/robbyOpenSideTop.jpg}[image label]
        \draw [orange, line width=3pt] (0.52,0.37) circle [radius=0.8cm] node [xshift=-1.25cm] {c};
        \draw [orange, line width=3pt] (0.835,0.23) circle [x radius=1.0cm, y radius=1.55cm] node [xshift=-1.5cm] {d};
        \draw [orange, line width=3pt] (0.6,0.55) circle [x radius=1.55cm, y radius=1.1cm] node [xshift=-1.5cm] {e};
      \end{tikzonimage}
    \end{figure}
    
    \begin{figure}[H]%
      \centering%
      \caption{blbla}%
      \label{}%
      \begin{tikzonimage}[width=\textwidth]{img/robbyOpenBottom.jpg}[image label]
        \draw [orange, line width=3pt] (0.4,0.39) circle [x radius=2.5cm, y radius=0.85cm] node [xshift=-2.95cm] {a};
        \draw [orange, line width=3pt] (0.4,0.56) circle [x radius=2.5cm, y radius=0.85cm] node [xshift=-2.95cm] {b};
        \draw [orange, line width=3pt] (0.66,0.485) circle [radius=0.8cm] node [xshift=-1.25cm] {c};
      \end{tikzonimage}
    \end{figure}
				
  \section{Programmablauf}\label{sec:Programmablauf}
    \autor{Tom Gehrke, Hannes Welling}
    Zunächst versucht der Roboter den Ball im abgetrennten Bereich zu finden. Dazu dreht er sich um seine eigene Achse um einen Gegenstand zu finden. Sobald ein Gegenstand registriert wird, fährt der Roboter auf diesen zu. Aufgrund der Ungenauigkeiten des Sensors und der Motoren, kann jedoch eine exakte Position des Balls noch nicht bestimmt werden. Deshalb nähert sich der Roboter so lange dem Ball, bis dieser nicht mehr im Sichtfeld des Ultraschallsensors liegt. Nun versucht der Roboter den Ball wieder zu finden und dreht sich alternierend um zunehmende Gradzahlen in beide Richtungen. Sobald der Ball wieder gefunden wurde, nähert sich der Roboter dem Ball weiter. Befindet sich der Ball in Reichweite des Grippers, wird dieser geschlossen und der Ball damit gegriffen. Abschließend fährt der Roboter mit dem Ball außerhalb des Bereiches und öffnet den Gripper, um den Ball los zu lassen.
    
    \begin{tikzpicture}[->,>=stealth']
       \node[state] (QUERY) {Wurstsalat mit Käse};

       \node[state, node distance=6cm, text width=3cm, right of=QUERY, yshift=+3cm] (RAKE)
        {Käse mit Holundersaft.};

       \node[state, right of=RAKE, node distance=5cm, text width=3cm] (ACK) 
        {Lecker Hackbraten};

       \node[state, below of=ACK, node distance=5cm] (EPC) 
        {Blabla};

       \path (QUERY)  edge
                        [bend left=50]  node
                                          [anchor=south,above,text width=4cm]
                                          {Aktion Saubermann}                  (RAKE)
             (RAKE)   edge                                                     (ACK)
             (ACK)    edge              node
                                          [anchor=east,right,
                                          text width=3cm,xshift=1em]
                                          {Aktion Sorgenrind}                  (EPC)

             (ACK)    edge
                        [bend left=45]  node
                                          [anchor=north,below,text width=4cm,
                                          yshift=-2em,xshift=-2em]
                                          {Aktions Angebot}                    (QUERY)
       ;
  \end{tikzpicture}
		
		\subsection{border-patrol}
		Um sicherzugehen, dass der Roboter das abgegrenzte Feld nicht verlässt, werden durch eine nebenläufige Funktion die Werte des Farbsensors, der auf den Boden gerichtet ist, überwacht. Gibt dieser Farbsensor innerhalb von etwas mehr als einer viertel Sekunde durchgehend den Wert für \textit{Weiß} zurück, wird eine globale Variable gesetzt, auf die der restliche Code reagiert und den Roboter stoppen und um \SI{180}{\degree} rotieren lässt. Es wird nicht sofort auf einen Wert für \textit{Weiß} reagiert, da so ein Wert, durch Unregelmäßigkeiten im Boden, vorkommen kann, ohne das der Roboter das Feld tatsächlich überschritten hat.

				
		%\subsection{Referenzen}\label{sec:Referenzen}
			%Es folgt eine Auflistung aller Referenzen zu den im Architekturentwurf erwähnten Fremdressourcen und verwendeten Dokumenten.
				%\printbibliography[heading=none]
		%
		
	%\clearpage
	%\listoffigures
	
	%\listoftables
	%\clearpage
	%\appendix
	
\end{document}
